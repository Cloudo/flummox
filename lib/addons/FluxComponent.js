'use strict';

exports.__esModule = true;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactComponentMethods = require('./reactComponentMethods');

var _objectAssign = require('object-assign');

var _objectAssign2 = _interopRequireDefault(_objectAssign);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Flux Component
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Component interface to reactComponentMethods module.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Children of FluxComponent are given access to the flux instance via
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * `context.flux`. Use this near the top of your app hierarchy and all children
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * will have easy access to the flux instance (including, of course, other
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Flux components!):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * <FluxComponent flux={flux}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *    ...the rest of your app
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * </FluxComponent>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Now any child can access the flux instance again like this:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * <FluxComponent>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *    ...children
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * </FluxComponent>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * We don't need the flux prop this time because flux is already part of
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * the context.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Additionally, immediate children are given a `flux` prop.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * The component has an optional prop `connectToStores`, which is passed to
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * `this.connectToStores` and used to set the initial state. The component's
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * state is injected as props to the child components.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * The practical upshot of all this is that fluxMixin, state changes, and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * context are now simply implementation details. Among other things, this means
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * you can write your components as plain ES6 classes. Here's an example:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * class ParentComponent extends React.Component {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *   render() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *     <FluxComponent connectToStores="fooStore">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *       <ChildComponent />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *     </FluxComponent>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *   }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * ChildComponent in this example has prop `flux` containing the flux instance,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * and props that sync with each of the state keys of fooStore.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */

var FluxComponent = function (_React$Component) {
  _inherits(FluxComponent, _React$Component);

  function FluxComponent(props, context) {
    _classCallCheck(this, FluxComponent);

    var _this = _possibleConstructorReturn(this, _React$Component.call(this, props, context));

    _this.initialize();

    _this.state = _this.connectToStores(props.connectToStores, props.stateGetter);

    _this.wrapChild = _this.wrapChild.bind(_this);
    return _this;
  }

  FluxComponent.prototype.wrapChild = function wrapChild(child) {
    return _react2['default'].cloneElement(child, this.getChildProps());
  };

  FluxComponent.prototype.getChildProps = function getChildProps() {
    var _props = this.props,
        children = _props.children,
        render = _props.render,
        connectToStores = _props.connectToStores,
        stateGetter = _props.stateGetter,
        flux = _props.flux,
        extraProps = _objectWithoutProperties(_props, ['children', 'render', 'connectToStores', 'stateGetter', 'flux']);

    return (0, _objectAssign2['default'])({ flux: this.getFlux() }, // TODO: remove in next major version
    this.state, extraProps);
  };

  FluxComponent.prototype.render = function render() {
    var _props2 = this.props,
        children = _props2.children,
        internalRender = _props2.render;


    if (typeof internalRender === 'function') {
      return internalRender(this.getChildProps(), this.getFlux());
    }

    if (!children) return null;

    if (!Array.isArray(children)) {
      var child = children;
      return this.wrapChild(child);
    } else {
      return _react2['default'].createElement(
        'span',
        null,
        _react2['default'].Children.map(children, this.wrapChild)
      );
    }
  };

  return FluxComponent;
}(_react2['default'].Component);

(0, _objectAssign2['default'])(FluxComponent.prototype, _reactComponentMethods.instanceMethods);

(0, _objectAssign2['default'])(FluxComponent, _reactComponentMethods.staticProperties);

exports['default'] = FluxComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hZGRvbnMvRmx1eENvbXBvbmVudC5qcyJdLCJuYW1lcyI6WyJGbHV4Q29tcG9uZW50IiwicHJvcHMiLCJjb250ZXh0IiwiaW5pdGlhbGl6ZSIsInN0YXRlIiwiY29ubmVjdFRvU3RvcmVzIiwic3RhdGVHZXR0ZXIiLCJ3cmFwQ2hpbGQiLCJiaW5kIiwiY2hpbGQiLCJjbG9uZUVsZW1lbnQiLCJnZXRDaGlsZFByb3BzIiwiY2hpbGRyZW4iLCJyZW5kZXIiLCJmbHV4IiwiZXh0cmFQcm9wcyIsImdldEZsdXgiLCJpbnRlcm5hbFJlbmRlciIsIkFycmF5IiwiaXNBcnJheSIsIkNoaWxkcmVuIiwibWFwIiwiQ29tcG9uZW50IiwicHJvdG90eXBlIl0sIm1hcHBpbmdzIjoiOzs7O0FBK0NBOzs7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7OzsrZUFqREE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBbURNQSxhOzs7QUFDSix5QkFBWUMsS0FBWixFQUFtQkMsT0FBbkIsRUFBNEI7QUFBQTs7QUFBQSxpREFDMUIsNEJBQU1ELEtBQU4sRUFBYUMsT0FBYixDQUQwQjs7QUFHMUIsVUFBS0MsVUFBTDs7QUFFQSxVQUFLQyxLQUFMLEdBQWEsTUFBS0MsZUFBTCxDQUFxQkosTUFBTUksZUFBM0IsRUFBNENKLE1BQU1LLFdBQWxELENBQWI7O0FBRUEsVUFBS0MsU0FBTCxHQUFpQixNQUFLQSxTQUFMLENBQWVDLElBQWYsT0FBakI7QUFQMEI7QUFRM0I7OzBCQUVERCxTLHNCQUFVRSxLLEVBQU87QUFDZixXQUFPLG1CQUFNQyxZQUFOLENBQ0xELEtBREssRUFFTCxLQUFLRSxhQUFMLEVBRkssQ0FBUDtBQUlELEc7OzBCQUVEQSxhLDRCQUFnQjtBQUFBLGlCQU9NLEtBQUtWLEtBUFg7QUFBQSxRQUVaVyxRQUZZLFVBRVpBLFFBRlk7QUFBQSxRQUdaQyxNQUhZLFVBR1pBLE1BSFk7QUFBQSxRQUlaUixlQUpZLFVBSVpBLGVBSlk7QUFBQSxRQUtaQyxXQUxZLFVBS1pBLFdBTFk7QUFBQSxRQU1aUSxJQU5ZLFVBTVpBLElBTlk7QUFBQSxRQU9UQyxVQVBTOztBQVNkLFdBQU8sK0JBQ0wsRUFBRUQsTUFBTSxLQUFLRSxPQUFMLEVBQVIsRUFESyxFQUNxQjtBQUMxQixTQUFLWixLQUZBLEVBR0xXLFVBSEssQ0FBUDtBQUtELEc7OzBCQUVERixNLHFCQUFTO0FBQUEsa0JBQ29DLEtBQUtaLEtBRHpDO0FBQUEsUUFDRFcsUUFEQyxXQUNEQSxRQURDO0FBQUEsUUFDaUJLLGNBRGpCLFdBQ1NKLE1BRFQ7OztBQUdQLFFBQUksT0FBT0ksY0FBUCxLQUEwQixVQUE5QixFQUEwQztBQUN4QyxhQUFPQSxlQUFlLEtBQUtOLGFBQUwsRUFBZixFQUFxQyxLQUFLSyxPQUFMLEVBQXJDLENBQVA7QUFDRDs7QUFFRCxRQUFJLENBQUNKLFFBQUwsRUFBZSxPQUFPLElBQVA7O0FBRWYsUUFBSSxDQUFDTSxNQUFNQyxPQUFOLENBQWNQLFFBQWQsQ0FBTCxFQUE4QjtBQUM1QixVQUFNSCxRQUFRRyxRQUFkO0FBQ0EsYUFBTyxLQUFLTCxTQUFMLENBQWVFLEtBQWYsQ0FBUDtBQUNELEtBSEQsTUFHTztBQUNMLGFBQU87QUFBQTtBQUFBO0FBQU8sMkJBQU1XLFFBQU4sQ0FBZUMsR0FBZixDQUFtQlQsUUFBbkIsRUFBNkIsS0FBS0wsU0FBbEM7QUFBUCxPQUFQO0FBQ0Q7QUFDRixHOzs7RUFqRHlCLG1CQUFNZSxTOztBQW9EbEMsK0JBQ0V0QixjQUFjdUIsU0FEaEI7O0FBS0EsK0JBQU92QixhQUFQOztxQkFFZUEsYSIsImZpbGUiOiJGbHV4Q29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBGbHV4IENvbXBvbmVudFxuICpcbiAqIENvbXBvbmVudCBpbnRlcmZhY2UgdG8gcmVhY3RDb21wb25lbnRNZXRob2RzIG1vZHVsZS5cbiAqXG4gKiBDaGlsZHJlbiBvZiBGbHV4Q29tcG9uZW50IGFyZSBnaXZlbiBhY2Nlc3MgdG8gdGhlIGZsdXggaW5zdGFuY2UgdmlhXG4gKiBgY29udGV4dC5mbHV4YC4gVXNlIHRoaXMgbmVhciB0aGUgdG9wIG9mIHlvdXIgYXBwIGhpZXJhcmNoeSBhbmQgYWxsIGNoaWxkcmVuXG4gKiB3aWxsIGhhdmUgZWFzeSBhY2Nlc3MgdG8gdGhlIGZsdXggaW5zdGFuY2UgKGluY2x1ZGluZywgb2YgY291cnNlLCBvdGhlclxuICogRmx1eCBjb21wb25lbnRzISk6XG4gKlxuICogPEZsdXhDb21wb25lbnQgZmx1eD17Zmx1eH0+XG4gKiAgICAuLi50aGUgcmVzdCBvZiB5b3VyIGFwcFxuICogPC9GbHV4Q29tcG9uZW50PlxuICpcbiAqIE5vdyBhbnkgY2hpbGQgY2FuIGFjY2VzcyB0aGUgZmx1eCBpbnN0YW5jZSBhZ2FpbiBsaWtlIHRoaXM6XG4gKlxuICogPEZsdXhDb21wb25lbnQ+XG4gKiAgICAuLi5jaGlsZHJlblxuICogPC9GbHV4Q29tcG9uZW50PlxuICpcbiAqIFdlIGRvbid0IG5lZWQgdGhlIGZsdXggcHJvcCB0aGlzIHRpbWUgYmVjYXVzZSBmbHV4IGlzIGFscmVhZHkgcGFydCBvZlxuICogdGhlIGNvbnRleHQuXG4gKlxuICogQWRkaXRpb25hbGx5LCBpbW1lZGlhdGUgY2hpbGRyZW4gYXJlIGdpdmVuIGEgYGZsdXhgIHByb3AuXG4gKlxuICogVGhlIGNvbXBvbmVudCBoYXMgYW4gb3B0aW9uYWwgcHJvcCBgY29ubmVjdFRvU3RvcmVzYCwgd2hpY2ggaXMgcGFzc2VkIHRvXG4gKiBgdGhpcy5jb25uZWN0VG9TdG9yZXNgIGFuZCB1c2VkIHRvIHNldCB0aGUgaW5pdGlhbCBzdGF0ZS4gVGhlIGNvbXBvbmVudCdzXG4gKiBzdGF0ZSBpcyBpbmplY3RlZCBhcyBwcm9wcyB0byB0aGUgY2hpbGQgY29tcG9uZW50cy5cbiAqXG4gKiBUaGUgcHJhY3RpY2FsIHVwc2hvdCBvZiBhbGwgdGhpcyBpcyB0aGF0IGZsdXhNaXhpbiwgc3RhdGUgY2hhbmdlcywgYW5kXG4gKiBjb250ZXh0IGFyZSBub3cgc2ltcGx5IGltcGxlbWVudGF0aW9uIGRldGFpbHMuIEFtb25nIG90aGVyIHRoaW5ncywgdGhpcyBtZWFuc1xuICogeW91IGNhbiB3cml0ZSB5b3VyIGNvbXBvbmVudHMgYXMgcGxhaW4gRVM2IGNsYXNzZXMuIEhlcmUncyBhbiBleGFtcGxlOlxuICpcbiAqIGNsYXNzIFBhcmVudENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gKlxuICogICByZW5kZXIoKSB7XG4gKiAgICAgPEZsdXhDb21wb25lbnQgY29ubmVjdFRvU3RvcmVzPVwiZm9vU3RvcmVcIj5cbiAqICAgICAgIDxDaGlsZENvbXBvbmVudCAvPlxuICogICAgIDwvRmx1eENvbXBvbmVudD5cbiAqICAgfVxuICpcbiAqIH1cbiAqXG4gKiBDaGlsZENvbXBvbmVudCBpbiB0aGlzIGV4YW1wbGUgaGFzIHByb3AgYGZsdXhgIGNvbnRhaW5pbmcgdGhlIGZsdXggaW5zdGFuY2UsXG4gKiBhbmQgcHJvcHMgdGhhdCBzeW5jIHdpdGggZWFjaCBvZiB0aGUgc3RhdGUga2V5cyBvZiBmb29TdG9yZS5cbiAqL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgaW5zdGFuY2VNZXRob2RzLCBzdGF0aWNQcm9wZXJ0aWVzIH0gZnJvbSAnLi9yZWFjdENvbXBvbmVudE1ldGhvZHMnO1xuaW1wb3J0IGFzc2lnbiBmcm9tICdvYmplY3QtYXNzaWduJztcblxuY2xhc3MgRmx1eENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzLCBjb250ZXh0KSB7XG4gICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuXG4gICAgdGhpcy5pbml0aWFsaXplKCk7XG5cbiAgICB0aGlzLnN0YXRlID0gdGhpcy5jb25uZWN0VG9TdG9yZXMocHJvcHMuY29ubmVjdFRvU3RvcmVzLCBwcm9wcy5zdGF0ZUdldHRlcik7XG5cbiAgICB0aGlzLndyYXBDaGlsZCA9IHRoaXMud3JhcENoaWxkLmJpbmQodGhpcyk7XG4gIH1cblxuICB3cmFwQ2hpbGQoY2hpbGQpIHtcbiAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KFxuICAgICAgY2hpbGQsXG4gICAgICB0aGlzLmdldENoaWxkUHJvcHMoKVxuICAgICk7XG4gIH1cblxuICBnZXRDaGlsZFByb3BzKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgcmVuZGVyLFxuICAgICAgY29ubmVjdFRvU3RvcmVzLFxuICAgICAgc3RhdGVHZXR0ZXIsXG4gICAgICBmbHV4LFxuICAgICAgLi4uZXh0cmFQcm9wcyB9ID0gdGhpcy5wcm9wcztcblxuICAgIHJldHVybiBhc3NpZ24oXG4gICAgICB7IGZsdXg6IHRoaXMuZ2V0Rmx1eCgpIH0sIC8vIFRPRE86IHJlbW92ZSBpbiBuZXh0IG1ham9yIHZlcnNpb25cbiAgICAgIHRoaXMuc3RhdGUsXG4gICAgICBleHRyYVByb3BzXG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBsZXQgeyBjaGlsZHJlbiwgcmVuZGVyOiBpbnRlcm5hbFJlbmRlciB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmICh0eXBlb2YgaW50ZXJuYWxSZW5kZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbFJlbmRlcih0aGlzLmdldENoaWxkUHJvcHMoKSwgdGhpcy5nZXRGbHV4KCkpO1xuICAgIH1cblxuICAgIGlmICghY2hpbGRyZW4pIHJldHVybiBudWxsO1xuXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGNoaWxkcmVuKSkge1xuICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbjtcbiAgICAgIHJldHVybiB0aGlzLndyYXBDaGlsZChjaGlsZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiA8c3Bhbj57UmVhY3QuQ2hpbGRyZW4ubWFwKGNoaWxkcmVuLCB0aGlzLndyYXBDaGlsZCl9PC9zcGFuPjtcbiAgICB9XG4gIH1cbn1cblxuYXNzaWduKFxuICBGbHV4Q29tcG9uZW50LnByb3RvdHlwZSxcbiAgaW5zdGFuY2VNZXRob2RzXG4pO1xuXG5hc3NpZ24oRmx1eENvbXBvbmVudCwgc3RhdGljUHJvcGVydGllcyk7XG5cbmV4cG9ydCBkZWZhdWx0IEZsdXhDb21wb25lbnQ7XG4iXX0=